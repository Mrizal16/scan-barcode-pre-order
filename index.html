<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scan Order | PO Kaos</title>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
  <main class="container">
    <header class="header">
      <div class="hdr-top">
        <h1>ğŸ“¦ Scan Pengambilan Order</h1>
        <span class="pill live" id="livePill">Idle</span>
      </div>
      <p class="muted">
        Scan QR berisi token. Server memverifikasi & mencegah scan ganda (global).
      </p>
      <div class="tips">
        <span>âœ… Tip: pakai koneksi <b>HTTPS</b> dan izinkan kamera.</span>
        <a class="link" href="./print.html">Butuh cetak QR dari <code>tokens.json</code>?</a>
      </div>
    </header>

    <section class="controls">
      <div class="control-grid">
        <label class="lbl" for="cameraSelect">Kamera</label>
        <select id="cameraSelect" class="input"></select>

        <label class="lbl">Resolusi</label>
        <select id="resSelect" class="input">
          <option value="280">280 (cepat)</option>
          <option value="360">360</option>
          <option value="420" selected>420 (disarankan)</option>
          <option value="520">520 (detail)</option>
        </select>

        <label class="lbl">Mode</label>
        <div class="toggle-row">
          <label class="switch">
            <input id="beepToggle" type="checkbox" checked>
            <span class="slider"></span>
          </label>
          <span class="muted small">Bunyi saat berhasil</span>
          <label class="switch" style="margin-left:12px">
            <input id="vibeToggle" type="checkbox" checked>
            <span class="slider"></span>
          </label>
          <span class="muted small">Getar saat berhasil</span>
        </div>
      </div>

      <div class="btn-row">
        <button id="startBtn" class="btn primary">â–¶ Mulai Scan</button>
        <button id="stopBtn" class="btn" disabled>â¹ Berhenti</button>
        <button id="flipBtn" class="btn">ğŸ”„ Flip Kamera</button>
        <button id="torchBtn" class="btn" disabled>ğŸ’¡ Nyalakan Flash</button>
      </div>

      <details class="fallback">
        <summary>âš™ï¸ Alternatif tanpa kamera (tempel token manual)</summary>
        <div class="fallback-row">
          <input id="manualInput" class="input" placeholder='Tempel token atau JSON {"t":"..."}'>
          <button id="manualBtn" class="btn">Verifikasi</button>
        </div>
      </details>
    </section>

    <section class="scanner">
      <div id="reader" class="reader">
        <div class="skeleton">
          <div class="spin"></div>
          <div>Siapkan kameraâ€¦</div>
        </div>
      </div>
    </section>

    <!-- ====== Panel Daftar Order (baru) ====== -->
    <section class="result-controls header">
      <div class="device-row" style="margin-top:6px;gap:10px;align-items:center">
        <label for="ordersFile">ğŸ“¥ Muat daftar order (tokens.json / orders.json)</label>
        <input type="file" id="ordersFile" accept=".json" />
        <button id="clearChecked" class="btn">Reset Centang</button>
      </div>
    </section>

    <section id="result" class="result"></section>

    <section class="orders card" id="ordersPanel" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
        <h2 style="margin:0">Daftar Order</h2>
        <div class="muted" id="ordersStats">0/0 selesai â€¢ Sisa 0</div>
      </div>
      <div class="hr"></div>
      <div class="table-wrap">
        <table id="ordersTable" class="table">
          <thead>
            <tr>
              <th>Status</th>
              <th>ID</th>
              <th>Nama</th>
              <th>Jumlah</th>
              <th>Ukuran</th>
              <th>Telepon</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
    <!-- ====== /Panel Daftar Order ====== -->

    <footer class="footer">
      <p class="muted">Â© PO Kaos â€¢ Privasi terjaga â€” tidak menyimpan gambar kamera.</p>
    </footer>
  </main>

  <audio id="beep" preload="auto">
    <source src="data:audio/wav;base64,UklGRhQAAABXQVZFZm10IBAAAAABAAEAgD4AAIA+AAABAAgAZGF0YQAAAAAAAP//AAD//wAA" type="audio/wav">
  </audio>

  <script src="./app.js"></script>
</body>
</html>
